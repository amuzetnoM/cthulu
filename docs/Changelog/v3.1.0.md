# v[3.1.0]
> 2025-12-07

Highlights
- Trade adoption and management: Cthulu can now detect and take control of trades entered outside of the bot.
- Manual trade CLI: `Cthulu-trade` provides simple CLI tooling to place, list, and close trades.
- Pydantic-based configuration validation and predefined trading mindsets for quick risk profiles.
- Startup reconciliation: Cthulu now automatically detects and tracks positions from previous sessions.
- Observability: Health endpoint and Prometheus metrics were added.
- Security: Pre-commit hooks and secret scanning baseline configured.

Key Changes
### Added
- `position/trade_manager.py` — External trade adoption and policies.
- `scripts/trade_cli.py` — Manual trade CLI utilities.
- `config/mindsets.py` — Trading mindset presets (aggressive, balanced, conservative).
- `config_schema.py` — Pydantic schema validation for configuration.
- `observability/health.py` and `observability/prometheus.py` — Health checks and metrics.

### Changed
- Position reconciliation at startup now detects and tracks pre-existing positions across sessions.
- Standardized exit strategy return types and priority semantics.

### Fixed
- Normalized exit strategy return types and fixed priority sorting in `ExitManager`.
- Corrected default values for `get_pnl_pips()` where appropriate.

Security
- `detect-secrets` pre-commit hooks and `.secrets.baseline` file.

Notes for Users
- If you run Cthulu in an environment where you place manual trades, consider enabling `orphan_trades` (now called adoption) in your config and tune `adopt_symbols` / `ignore_symbols`, `max_age_hours`, and `log_only` for safe adoption.
- `Cthulu-trade` will use Cthulu's magic number for placed trades, so they will be tracked by the bot.

Migration Guide (from v3.0.0)
1. **Configuration Updates** - Add new `orphan_trades` section as documented in the release notes.
2. **Environment Variables** (optional) - see release body for examples.
3. **Dependencies**: Run `pip install -r requirements.txt --upgrade`
4. **Pre-commit Setup** (for developers): `pip install pre-commit && pre-commit install`

CLI Usage Examples
- `Cthulu-trade list`
- `Cthulu-trade buy EURUSD 0.01 --dry-run`
- `Cthulu-trade close EURUSD --all`
- Health check: `curl http://localhost:8080/health`

Production Notes
- Use `log_only: true` initially for adoption testing
- Ensure `Cthulu-trade` uses the same `config.json`
- Metrics: Prometheus metrics at `/metrics`





