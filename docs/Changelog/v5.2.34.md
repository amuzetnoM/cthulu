# v5.2.34 "PRECISION" â€” 2026-01-17

> Execution quality improvements based on comprehensive system audit

**Status:** âœ… RELEASED

## Summary

This release implements critical improvements identified in the execution loop audit (`AUDIT_EXECUTION_LOOP.md`) and main loop audit (`AUDIT_MAIN_LOOP.md`). The focus is on **quality over quantity** â€” ensuring only the best setups execute while letting winners run.

## Key Changes

### 1. Strict Entry Quality Gate

Only GOOD and PREMIUM quality entries now proceed to execution:

| Quality | Score | Action |
|---------|-------|--------|
| PREMIUM | â‰¥85 | Execute with full size |
| GOOD | â‰¥70 | Execute with 0.85x size |
| MARGINAL | 50-69 | Queue for better price |
| POOR | 20-49 | Block entirely |
| REJECT | <20 | Block entirely |

**Before:** MARGINAL entries executed with reduced size (0.6x)
**After:** MARGINAL entries queued, only GOOD/PREMIUM execute

### 2. Momentum Detection in Profit Scaler

New `_has_strong_momentum()` method prevents cutting winning trades:

```python
# Checks last 5 bars for:
# - Consecutive moves in trade direction (â‰¥3 = strong momentum)
# - Price acceleration (recent bars 50%+ bigger than older bars)

# When strong momentum detected:
# - Defer partial closes
# - Allow trailing stop updates
# - Log: "ðŸš€ Deferring scaling: Strong momentum detected"
```

### 3. Centralized Position Sizing

All position size adjustments now happen in one place with full audit trail:

```python
@dataclass
class PositionSizeDecision:
    base_size: float
    adjustments: List[Tuple[str, float]]  # (reason, multiplier)
    final_size: float
    reasoning: str  # e.g., "0.10 Ã— (entry_quality(good)=0.85 Ã— cognition=1.10) â†’ 0.09"
```

### 4. Recalibrated Profit Tiers

| Tier | Old Threshold | New Threshold | Old Close | New Close |
|------|---------------|---------------|-----------|-----------|
| 1 | 50% | 100% (1R) | 25% | 20% |
| 2 | 80% | 150% (1.5R) | 35% | 30% |
| 3 | 120% | 200% (2R) | 50% | 40% |

## Configuration Changes

### New Options

```json
{
  "risk": {
    "performance_based_sizing": true,    // Enable win-rate based sizing
    "min_risk_reward_ratio": 1.5,        // Explicit R:R minimum
    "drawdown_halt_percent": 40.0        // Stop trading threshold
  },
  "entry_confluence": {
    "strict_quality_gate": true,         // Enable strict quality filtering
    "trend_weight": 0.20                  // Weight for trend scoring
  },
  "profit_scaling": {
    "momentum_check_enabled": true,      // Enable momentum detection
    "tiers": [...]                        // Explicit tier configuration
  }
}
```

### Changed Defaults

| Setting | Old | New | Reason |
|---------|-----|-----|--------|
| `confidence_threshold` | 0.4 | 0.5 | Higher confidence required |
| `min_score_to_enter` | 40 | 50 | Stricter entry gate |
| `min_score_for_full_size` | 65 | 70 | Higher bar for full size |
| `require_trend_alignment` | false | true | Trade with trend |
| `min_confirmation_strategies` | 1 | 2 | Multiple strategy confirm |
| `multi_rrr_exit.enabled` | true | false | Avoid conflict with profit_scaling |
| `survival_threshold_pct` | 50% | 40% | Earlier survival mode |

## Bug Fixes

- **test_auto_tune_runner.py:** Fixed by mocking `HistoricalDataManager` for data fetch
- **test_symbol_matching.py:** Updated to reflect simplified symbol matching (exact match required)

## Files Changed

- `core/trading_loop.py` - Strict quality gate, centralized sizing
- `position/profit_scaler.py` - Momentum detection
- `config.json` - Optimized configuration
- `tests/unit/test_auto_tune_runner.py` - Fixed test
- `tests/unit/test_symbol_matching.py` - Updated tests

## Migration Guide

### If using old config:

1. Add new risk options:
```json
"risk": {
  "performance_based_sizing": true,
  "min_risk_reward_ratio": 1.5,
  "drawdown_halt_percent": 40.0
}
```

2. Update entry confluence:
```json
"entry_confluence": {
  "strict_quality_gate": true,
  "min_score_to_enter": 50,
  "require_trend_alignment": true
}
```

3. Disable multi_rrr if using profit_scaling:
```json
"multi_rrr_exit": {
  "enabled": false
}
```

## Philosophy

This release embodies **quality over quantity**:

1. **Stricter entry gates** â€” Only best setups execute
2. **Let winners run** â€” Momentum-aware scaling, higher profit thresholds
3. **Protect capital** â€” Earlier drawdown protection
4. **Full transparency** â€” Centralized sizing with complete audit trail
5. **Trade with trend** â€” Alignment required for entry

---

*Based on recommendations from AUDIT_EXECUTION_LOOP.md and AUDIT_MAIN_LOOP.md*
